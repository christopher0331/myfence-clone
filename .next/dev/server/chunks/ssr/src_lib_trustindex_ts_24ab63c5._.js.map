{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/dev/repos/myfence-clone/src/lib/trustindex.ts"],"sourcesContent":["export const TRUSTINDEX_WIDGET_ID = \"d273c79511b386516c861cd858a\";\r\nexport const TRUSTINDEX_SCRIPT_SRC = `https://cdn.trustindex.io/loader.js?${TRUSTINDEX_WIDGET_ID}`;\r\n\r\ntype MountOptions = {\r\n  /** Only load the script when the widget scrolls near the viewport */\r\n  rootMargin?: string;\r\n  /** If true, load immediately without intersection gating */\r\n  immediate?: boolean;\r\n  /** Delay before loading the script after intersection */\r\n  delayMs?: number;\r\n  /** Called once the loader script is loaded (or already present) */\r\n  onLoaded?: () => void;\r\n};\r\n\r\nfunction runWhenIdle(cb: () => void, timeoutMs = 1500) {\r\n  const w = window as unknown as {\r\n    requestIdleCallback?: (fn: () => void, opts?: { timeout: number }) => number;\r\n    cancelIdleCallback?: (id: number) => void;\r\n  };\r\n\r\n  if (w.requestIdleCallback) {\r\n    const id = w.requestIdleCallback(cb, { timeout: timeoutMs });\r\n    return () => w.cancelIdleCallback?.(id);\r\n  }\r\n\r\n  const t = window.setTimeout(cb, 0);\r\n  return () => window.clearTimeout(t);\r\n}\r\n\r\nfunction ensureTrustindexScript(onLoaded?: () => void) {\r\n  const existing = document.querySelector<HTMLScriptElement>(\r\n    `script[src^=\"${TRUSTINDEX_SCRIPT_SRC}\"]`,\r\n  );\r\n\r\n  if (existing) {\r\n    console.info(\"[Trustindex] script already present\");\r\n    onLoaded?.();\r\n    return () => {};\r\n  }\r\n\r\n  console.info(\"[Trustindex] injecting script\", TRUSTINDEX_SCRIPT_SRC);\r\n  const script = document.createElement(\"script\");\r\n  script.src = TRUSTINDEX_SCRIPT_SRC;\r\n  script.async = true;\r\n  script.defer = true;\r\n  script.onload = () => onLoaded?.();\r\n  script.onerror = (e) => console.error(\"[Trustindex] script load error\", e);\r\n  document.body.appendChild(script);\r\n\r\n  return () => {\r\n    // Keep the script around once loaded to avoid churn; removing/re-adding can cause more work.\r\n  };\r\n}\r\n\r\nexport function mountTrustindexWidget(container: HTMLElement, options: MountOptions = {}) {\r\n  const { rootMargin = \"250px\", delayMs = 1200, onLoaded, immediate = false } = options;\r\n\r\n  const widgetDiv = document.createElement(\"div\");\r\n  widgetDiv.setAttribute(\"data-widget-id\", TRUSTINDEX_WIDGET_ID);\r\n  widgetDiv.className = \"trustindex-widget\";\r\n  container.appendChild(widgetDiv);\r\n  console.info(\"[Trustindex] widget div appended\");\r\n\r\n  let cancelled = false;\r\n  let cancelIdle: (() => void) | null = null;\r\n  let delayTimer: number | null = null;\r\n\r\n  const load = () => {\r\n    if (cancelled) return;\r\n    cancelIdle = runWhenIdle(() => {\r\n      if (cancelled) return;\r\n      ensureTrustindexScript(onLoaded);\r\n    });\r\n  };\r\n\r\n  if (immediate) {\r\n    console.info(\"[Trustindex] immediate load requested\");\r\n    delayTimer = window.setTimeout(load, delayMs);\r\n  } else {\r\n    const observer = new IntersectionObserver(\r\n      ([entry]) => {\r\n        if (!entry.isIntersecting) return;\r\n        observer.disconnect();\r\n        delayTimer = window.setTimeout(load, delayMs);\r\n      },\r\n      { rootMargin },\r\n    );\r\n\r\n    console.info(\"[Trustindex] observing for viewport\", { rootMargin });\r\n    observer.observe(container);\r\n  }\r\n\r\n  return () => {\r\n    cancelled = true;\r\n    // observer only exists when not immediate\r\n    // @ts-ignore\r\n    if (typeof observer !== \"undefined\") observer.disconnect();\r\n    if (delayTimer) window.clearTimeout(delayTimer);\r\n    cancelIdle?.();\r\n    widgetDiv.remove();\r\n  };\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;;AAAO,MAAM,uBAAuB;AAC7B,MAAM,wBAAwB,CAAC,oCAAoC,EAAE,sBAAsB;AAalG,SAAS,YAAY,EAAc,EAAE,YAAY,IAAI;IACnD,MAAM,IAAI;IAKV,IAAI,EAAE,mBAAmB,EAAE;QACzB,MAAM,KAAK,EAAE,mBAAmB,CAAC,IAAI;YAAE,SAAS;QAAU;QAC1D,OAAO,IAAM,EAAE,kBAAkB,GAAG;IACtC;IAEA,MAAM,IAAI,OAAO,UAAU,CAAC,IAAI;IAChC,OAAO,IAAM,OAAO,YAAY,CAAC;AACnC;AAEA,SAAS,uBAAuB,QAAqB;IACnD,MAAM,WAAW,SAAS,aAAa,CACrC,CAAC,aAAa,EAAE,sBAAsB,EAAE,CAAC;IAG3C,IAAI,UAAU;QACZ,QAAQ,IAAI,CAAC;QACb;QACA,OAAO,KAAO;IAChB;IAEA,QAAQ,IAAI,CAAC,iCAAiC;IAC9C,MAAM,SAAS,SAAS,aAAa,CAAC;IACtC,OAAO,GAAG,GAAG;IACb,OAAO,KAAK,GAAG;IACf,OAAO,KAAK,GAAG;IACf,OAAO,MAAM,GAAG,IAAM;IACtB,OAAO,OAAO,GAAG,CAAC,IAAM,QAAQ,KAAK,CAAC,kCAAkC;IACxE,SAAS,IAAI,CAAC,WAAW,CAAC;IAE1B,OAAO;IACL,6FAA6F;IAC/F;AACF;AAEO,SAAS,sBAAsB,SAAsB,EAAE,UAAwB,CAAC,CAAC;IACtF,MAAM,EAAE,aAAa,OAAO,EAAE,UAAU,IAAI,EAAE,QAAQ,EAAE,YAAY,KAAK,EAAE,GAAG;IAE9E,MAAM,YAAY,SAAS,aAAa,CAAC;IACzC,UAAU,YAAY,CAAC,kBAAkB;IACzC,UAAU,SAAS,GAAG;IACtB,UAAU,WAAW,CAAC;IACtB,QAAQ,IAAI,CAAC;IAEb,IAAI,YAAY;IAChB,IAAI,aAAkC;IACtC,IAAI,aAA4B;IAEhC,MAAM,OAAO;QACX,IAAI,WAAW;QACf,aAAa,YAAY;YACvB,IAAI,WAAW;YACf,uBAAuB;QACzB;IACF;IAEA,IAAI,WAAW;QACb,QAAQ,IAAI,CAAC;QACb,aAAa,OAAO,UAAU,CAAC,MAAM;IACvC,OAAO;QACL,MAAM,YAAW,IAAI,qBACnB,CAAC,CAAC,MAAM;YACN,IAAI,CAAC,MAAM,cAAc,EAAE;YAC3B,UAAS,UAAU;YACnB,aAAa,OAAO,UAAU,CAAC,MAAM;QACvC,GACA;YAAE;QAAW;QAGf,QAAQ,IAAI,CAAC,uCAAuC;YAAE;QAAW;QACjE,UAAS,OAAO,CAAC;IACnB;IAEA,OAAO;QACL,YAAY;QACZ,0CAA0C;QAC1C,aAAa;QACb,IAAI,OAAO,aAAa,aAAa,SAAS,UAAU;QACxD,IAAI,YAAY,OAAO,YAAY,CAAC;QACpC;QACA,UAAU,MAAM;IAClB;AACF"}}]
}